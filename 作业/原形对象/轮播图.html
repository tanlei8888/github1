<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        *{
            margin: 0;
            padding: 0;
        }
        .container{
            width: 420px;
            height: 250px;
            margin: 50px auto;
            background-color: grey;
            padding: 10px 0;
            position: relative;
            overflow: hidden;
        }
        #imgul{
            position: absolute;
            list-style: none;
            /* overflow: hidden; */
            
        }
        .imgul li{
            width: 400px; 
            padding:0 10px;
            float: left;
        }
        #nav a{
            width: 15px;
            height: 15px;
            border-radius: 50%;
            float: left;
            background-color: white;
            margin: 0 10px;
        }
    </style>
</head>
<body>
    <div id="container" class="container">
        <ul id="imgul" class="imgul">
            <li><img src="./img/lunbotu1.jpg" alt=""></li>
            <li><img src="./img/lunbotu3.jpg" alt=""></li>
            <li><img src="./img/lunbotu4.jpg" alt=""></li>
            <li><img src="./img/lunbotu1.jpg" alt=""></li>
        </ul>
        <div id="nav">
            <a></a>
            <a></a>
            <a></a>
        </div>
    </div>
</body>
<script>
    let oCantainer = document.getElementById("container");
    let oUl = document.getElementById("imgul");
    let aImg = document.getElementsByTagName("img");
    let navDiv = document.getElementById("nav");
    let aNav = document.getElementsByTagName("a");
    let containerWidth = oCantainer.offsetWidth;
    oUl.style.width = containerWidth*aImg.length + "px";
    navDiv.style.position = "absolute";
    navDiv.style.bottom = 10 + "px";
    navDiv.style.left = (oCantainer.offsetWidth - navDiv.offsetWidth)/2 + "px"
    let index = 0;
    let time;
    aNav[index].style.backgroundColor = "gray"
    
    click();
    change()
    //点击事件
    function click(){
        for(let i = 0; i < aNav.length; i++){
            aNav[i].num = i;
            aNav[i].addEventListener("click",function(){
                //每次点击先清除定时器,否则点的越多 定时器越快
                clearInterval(time)
                // debugger
                // console.log(time)
                index = this.num;   
                console.log(index)
                //清空样式
                reset();
                // debugger
                //当点击导航点 调用move切换图片并结束move的定时器,并回调change的定时器开始轮播
                move(oUl,"left",-containerWidth*index,10,function(){
                    change();   
                })
            })
        }
    }
    //开始轮播
    function change(){
        time = setInterval(() => {
            index++;
            index %= aImg.length;
            // debugger
            //轮播目标位置结束,回调 reset函数 初始化初始化样式
            move(oUl,"left",-containerWidth*index,10,function(){ 
                reset(); 
            });
        }, 3000);
    }

    //切换图片
    function move(obj,attr,target,speed,callback){
        clearInterval(obj.timer)
        let objLeft = obj.offsetLeft;
        //点击导航栏切换图片时 切换speed的 + -
        if(objLeft > target){
            speed = -speed;
        }
        console.log(objLeft)
        console.log(target  )
        obj.timer = setInterval(() => {
            // debugger
            objLeft = obj.offsetLeft;
            let newLeft = objLeft  + speed;
            console.log(newLeft)
            if((speed < 0 && newLeft < target) || (speed > 0 && newLeft > target)){
                newLeft = target
            }
            obj.style[attr] = newLeft + "px";
            //如果到达移动最终位置 清空定时器
            if(newLeft == target){
                clearInterval(obj.timer);
                callback && callback();
            }
        }, 10);
    }
    
    //样式重置
    function reset(){
        if( index >= aNav.length){
            index = 0;
            oUl.style.left = 0;
        }
        for(let i = 0; i < aNav.length; i++){
            aNav[i].style.backgroundColor = "";
        }
        aNav[index].style.backgroundColor = "gray"
    }
   

    















    // init(oCantainer,oUl,aNav)
    // //初始化界面
    // function init(oCantainer,oUl,aNav){
    //     aNav[0].style.backgroundColor = "gray"
    //     nav(aNav,oUl)
        
    //     let times;
    //     setInterval(() => {
    //        setA(aNav)
    //         index++
    //         if(index > aImg.length){
    //             index = 1
    //         }
    //         move(oUl,oCantainer,index,times)
    //     },3000);
        
    // }
    // // 图片移动
    // function move(obj,obj1,index,times){
    //     // debugger
    //     clearInterval(obj.times)
    //     obj.times = setInterval(() => {
    //         let speed = 20;
    //         let aImgwidth = obj1.offsetWidth;
    //         let objleft = obj.offsetLeft;
    //         console.log(objleft)
    //         let newLeft = objleft - speed
    //         if(objleft >= - (aImgwidth*index-speed)){
    //             obj.style.left = newLeft + "px"
    //             console.log(objleft)
    //         }else{
    //             clearInterval(obj.times)
    //         }
    //    }, 60);
    // }
    // //绑定导航栏点击事件
    // function nav(obj,obj1){
    //     // console.log(obj)
    //     for(let i = 0; i < obj.length; i++){
    //         // debugger
    //         obj[i].onclick = function(){
    //             for(let j = 0; j < obj.length; j++){
    //                 obj[j].style.backgroundColor = "white";
    //             }
    //             obj[i].style.backgroundColor = "gray";
    //             obj1.style.left = i*-400 +"px"
    //         }
    //     }
    // }
    // function setA(obj){
    //     for(let i = 0; i < obj.length; i++){
    //         // debugger
    //         for(let j = 0; j < obj.length; j++){
    //             obj[j].style.backgroundColor = "white";
    //         }
    //         obj[i].style.backgroundColor = "gray";
          
    //     }
    // }
</script>
</html>